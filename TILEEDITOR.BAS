10 MODE 8
20 PROCsetup
30 REPEAT
40     IF EDITOR_MODE%=0 THEN PROCselect_pixel_mode
50     IF EDITOR_MODE%=1 THEN PROCselect_palette_mode
60 UNTIL FALSE
70 END
80 :
90 DEF PROCsetup
100 :
110     REM DISABLE CURSOR FLASHING
120     VDU 23,1,0,0,0,0,0,0,0,0
130     :
140     REM DISABLE SCREEN SCROLLING
150     VDU 23,16,1,255,0,0,0,0,0,0
160     :
170     REM UNLOCK THE TILE ENGINE FEATURE FLAG
180     VDU 23,0,248,768;0;
190     :
200     REM INIT TILEBANK
210     VDU 23,0,194,0,0,0,0,0
220     :
230     REM SET PALETTE CURSOR TO TOP LEFT OF PALETTE WINDOW
240     PALETTE_CURSORX%=0
250     PALETTE_CURSORY%=0
260     :
270     REM SET DEFAULT SELECTED COLOUR TO BLACK (192)
280     SELECTEDCOLOUR_WC%=192
290     :
300     REM SETUP UDG
310     PROCsetupudg
320     :
330     REM SET INITIAL EDITOR MODE: 0=PIXEL EDIT, 1=COLOUR SELECT
340     EDITOR_MODE%=0
350     :
360     REM DRAW HEADER AND FOOTER THEN REPOSITION CURSOR TO AVOID SCROLLING SCREEN
370     PROCdraw_header
380     VDU 31,0,2
390     PROCdraw_footer("")
400     VDU 31,0,2
410     :
420     REM SETUP PALETTE, CURSOR AND TRANSPARENT TILES
430     PROCsetup_palette_array
440     PROCsetup_palette_tiles
450     PROCsetup_cursor_tile
460     PROCsetup_transparent_tile
470     :
480     REM DRAW THE PALETTE WINDOW AND CONTENTS
490     PALETTE_WX%=1
500     PALETTE_WY%=12
510     PALETTE_WW%=18
520     PALETTE_WH%=6
530     PALETTE_WC%=7
540     PROCdrawframe(PALETTE_WX%, PALETTE_WY%, PALETTE_WW%, PALETTE_WH%, PALETTE_WC%)
550     PROCdraw_palette_window
560     :
570     REM DRAW THE COLOUR SELECTION WINDOW
580     SELECTEDCOLOUR_WX%=11
590     SELECTEDCOLOUR_WY%=2
600     SELECTEDCOLOUR_WW%=4
610     SELECTEDCOLOUR_WH%=4
620     PROCdrawframe(SELECTEDCOLOUR_WX%, SELECTEDCOLOUR_WY%, SELECTEDCOLOUR_WW%, SELECTEDCOLOUR_WH%, SELECTEDCOLOUR_WC%)
630     PROCdraw_colour_selection(SELECTEDCOLOUR_WX%, SELECTEDCOLOUR_WY%, SELECTEDCOLOUR_WW%, SELECTEDCOLOUR_WH%, SELECTEDCOLOUR_WC%)
640     :
650     REM SETUP PIXEL EDITOR WINDOW
660     PROCsetup_pixel_array
670     REM DRAW THE PIXEL EDITOR WINDOW
680     PIXEL_WX%=1
690     PIXEL_WY%=2
700     PIXEL_WW%=10
710     PIXEL_WH%=10
720     PIXEL_WC%=7
730     PIXEL_CURSORX%=0
740     PIXEL_CURSORY%=0
750     PROCdrawframe(PIXEL_WX%, PIXEL_WY%, PIXEL_WW%, PIXEL_WH%, PIXEL_WC%)
760     PROCdraw_pixel_window
770     :
780     REM SET PREVIEW BACKGROUND COLOUR (0-4)
790     BGCYCLE%=0
800     BGCOLOUR%=192
810     :
820     REM DRAW THE PREVIEW WINDOW
830     PREVIEW_WX%=11
840     PREVIEW_WY%=8
850     PREVIEW_WW%=4
860     PREVIEW_WH%=4
870     PREVIEW_WC%=7
880     PROCdrawframe(PREVIEW_WX%, PREVIEW_WY%, PREVIEW_WW%, PREVIEW_WH%, PREVIEW_WC%)
890     PROCdraw_preview_window
900     :
910     REM DRAW THE REFLECTION PREVIEW WINDOW
920     REFLECTION_WX%=15
930     REFLECTION_WY%=8
940     REFLECTION_WW%=4
950     REFLECTION_WH%=4
960     REFLECTION_WC%=7
970     PROCdrawframe(REFLECTION_WX%, REFLECTION_WY%, REFLECTION_WW%, REFLECTION_WH%, REFLECTION_WC%)
980     PROCdraw_reflection_window
990     :
1000     REM DRAW THE SINGLE PREVIEW WINDOW
1010     PRSINGLEWX%=15
1020     PRSINGLEWY%=2
1030     PRSINGLEWW%=4
1040     PRSINGLEWH%=4
1050     PRSINGLEWC%=7
1060     PROCdrawframe(PRSINGLEWX%, PRSINGLEWY%, PRSINGLEWW%, PRSINGLEWH%, PRSINGLEWC%)
1070     PROCdraw_single_window
1080     :
1090     REM DEFINE THE SIZE OF THE FILE INPUT DIALOGUE BOX
1100     DIALOGUE_WX%=1
1110     DIALOGUE_WY%=20
1120     DIALOGUE_WW%=30
1130     DIALOGUE_WH%=3
1140     DIALOGUE_WC%=7
1150     :
1160     REM FILENAME VARIABLE
1170     FILENAME$=""
1180     :
1190 ENDPROC
1200 :
1210 DEF PROCsetup_palette_tiles
1220     LOCAL J%, K%
1230     FOR J%=192 TO 255 STEP 1
1240       VDU 23,0,194,1,0,J%
1250       FOR K%=0 TO 63
1260         VDU J%
1270       NEXT K%
1280     NEXT J%
1290 ENDPROC
1300 :
1310 DEF PROCsetup_cursor_tile
1320     LOCAL J%, D%, TILE_ID%
1330     TILE_ID%=1
1340     VDU 23,0,194,1,0,TILE_ID%
1350     FOR J%=0 TO 63
1360       READ D%
1370       VDU D%
1380     NEXT J%
1390     DATA 255,255,255,255,255,255,255,192
1400     DATA 255,0,0,0,0,0,0,192
1410     DATA 255,0,0,0,0,0,0,192
1420     DATA 255,0,0,0,0,0,0,192
1430     DATA 255,0,0,0,0,0,0,192
1440     DATA 255,0,0,0,0,0,0,192
1450     DATA 255,0,0,0,0,0,0,192
1460     DATA 255,192,192,192,192,192,192,192
1470 ENDPROC
1480 :
1490 DEF PROCsetup_transparent_tile
1500     LOCAL J%, D%, TILE_ID%
1510     TILE_ID%=2
1520     VDU 23,0,194,1,0,TILE_ID%
1530     FOR J%=0 TO 63
1540     READ D%
1550     VDU D%
1560     NEXT J%
1570     DATA 234,234,213,213,234,234,213,213
1580     DATA 234,234,213,213,234,234,213,213
1590     DATA 213,213,234,234,213,213,234,234
1600     DATA 213,213,234,234,213,213,234,234
1610     DATA 234,234,213,213,234,234,213,213
1620     DATA 234,234,213,213,234,234,213,213
1630     DATA 213,213,234,234,213,213,234,234
1640     DATA 213,213,234,234,213,213,234,234
1650 ENDPROC
1660 :
1670 DEF PROCsetupudg
1680     REM horizontal bar
1690     VDU 23,224,0,255,0,0,0,0,255,0
1700     REM vertical bar
1710     VDU 23,225,66,66,66,66,66,66,66,66
1720     REM top left corner
1730     VDU 23,226,0,127,64,64,64,64,67,66
1740     REM top right corner
1750     VDU 23,227,0,254,2,2,2,2,194,66
1760     REM bottom left corner
1770     VDU 23,228,66,67,64,64,64,64,127,0
1780     REM bottom right corner
1790     VDU 23,229,66,194,2,2,2,2,254,0
1800     REM T facing right
1810     VDU 23,230,66,67,64,64,64,64,67,66
1820     REM T facing down
1830     VDU 23,231,0,255,0,0,0,0,195,66
1840     REM T facing up
1850     VDU 23,232,0,66,195,0,0,0,0,255,0
1860     REM T facing left
1870     VDU 23,233,66,194,2,2,2,2,194,66
1880     REM right end
1890     VDU 23,234,0,252,2,1,1,2,252,0
1900     REM left end
1910     VDU 23,235,0,63,64,128,128,64,63,0
1920     REM up end
1930     VDU 23,236,24,36,66,66,66,66,66,66
1940     REM down end
1950     VDU 23,237,66,66,66,66,66,66,36,24
1960     REM solid block
1970     VDU 23,238,255,255,255,255,255,255,255,255
1980 ENDPROC
1990 :
2000 DEF PROCdrawframe(X%, Y%, W%, H%, C%)
2010     LOCAL I%
2020     COLOUR C%
2030     PRINT TAB(X%,Y%)CHR$(226)
2040     PRINT TAB(X%,Y%+H%-1)CHR$(228)
2050     FOR I%=1 TO W%-2
2060       PRINT TAB(X%+I%,Y%)CHR$(224)
2070       PRINT TAB(X%+I%,Y%+H%-1)CHR$(224)
2080     NEXT I%
2090     PRINT TAB(X%+W%-1,Y%)CHR$(227)
2100     PRINT TAB(X%+W%-1,Y%+H%-1)CHR$(229)
2110     FOR I%=1 TO H%-2
2120       PRINT TAB(X%,Y%+I%)CHR$(225)
2130       PRINT TAB(X%+W%-1,Y%+I%)CHR$(225)
2140     NEXT I%
2150 ENDPROC
2160 :
2170 DEF PROCdraw_palette_window
2180     LOCAL R%, C%, T%
2190     T%=192
2200     FOR R%=0 TO 3
2210       FOR C%=0 TO 15
2220         VDU 23,0,194,6,0,T%,0,C%+PALETTE_WX%+1,R%+PALETTE_WY%+1,0,0,0
2230         T%=T%+1
2240       NEXT C%
2250     NEXT R%
2260 ENDPROC
2270 :
2280 DEF PROCsetup_palette_array
2290     LOCAL R%, C%, T%
2300     DIM PALETTE%(15,3)
2310     T%=192
2320     FOR R%=0 TO 3
2330       FOR C%=0 TO 15
2340         PALETTE%(C%,R%)=T%
2350         T%=T%+1
2360       NEXT C%
2370     NEXT R%
2380 ENDPROC
2390 :
2400 DEF PROCnavigate_palette
2410     REM LOOP INPUT UNTIL TAB (TO CHANGE MODE)
2420     REPEAT
2430         A$=GET$
2440         IF ASC(A$)=8 THEN PROCmove_palette_cursor(PALETTE_WX%, PALETTE_WY%, PALETTE_WW%, PALETTE_WH%,PALETTE_CURSORX%-1,PALETTE_CURSORY%)
2450         IF ASC(A$)=11 THEN PROCmove_palette_cursor(PALETTE_WX%, PALETTE_WY%, PALETTE_WW%, PALETTE_WH%,PALETTE_CURSORX%,PALETTE_CURSORY%-1)
2460         IF ASC(A$)=21 THEN PROCmove_palette_cursor(PALETTE_WX%, PALETTE_WY%, PALETTE_WW%, PALETTE_WH%,PALETTE_CURSORX%+1,PALETTE_CURSORY%)
2470         IF ASC(A$)=10 THEN PROCmove_palette_cursor(PALETTE_WX%, PALETTE_WY%, PALETTE_WW%, PALETTE_WH%,PALETTE_CURSORX%,PALETTE_CURSORY%+1)
2480         IF ASC(A$)=13 THEN PROCselect_colour(PALETTE_CURSORX%, PALETTE_CURSORY%)
2490         IF ASC(A$)=9 THEN EDITOR_MODE%=0
2500         IF A$="T" THEN PROCselect_transparent
2510         IF A$="Q" THEN PROCexit
2520         IF A$="S" THEN PROCsavetile
2530         IF A$="L" THEN PROCloadtile
2540         IF A$="B" THEN PROCcycle_background_colour
2550     UNTIL EDITOR_MODE%<>1
2560 ENDPROC
2570 :
2580 DEF PROCmove_palette_cursor(PALETTE_WX%, PALETTE_WY%, PALETTE_WW%, PALETTE_WH%, NEW_CURSORX%, NEW_CURSORY%)
2590     LOCAL TILE_ID%
2600     IF NEW_CURSORX%<0 THEN NEW_CURSORX%=0
2610     IF NEW_CURSORX%>15 THEN NEW_CURSORX%=15
2620     IF NEW_CURSORY%<0 THEN NEW_CURSORY%=0
2630     IF NEW_CURSORY%>3 THEN NEW_CURSORY%=3
2640     REM DRAW UNDERLYING TILE OVER OLD CURSOR LOCATION
2650     TILE_ID%=PALETTE%(PALETTE_CURSORX%,PALETTE_CURSORY%)
2660     VDU 23,0,194,6,0,TILE_ID%,0,PALETTE_WX%+PALETTE_CURSORX%+1,PALETTE_WY%+PALETTE_CURSORY%+1,0,0,0
2670     REM DRAW CURSOR AT NEW POSITION
2680     PALETTE_CURSORX%=NEW_CURSORX%
2690     PALETTE_CURSORY%=NEW_CURSORY%
2700     PROCdraw_palette_cursor
2710 ENDPROC
2720 :
2730 DEF PROCdraw_palette_cursor
2740     LOCAL TILE_ID%
2750     TILE_ID%=1
2760     VDU 23,0,194,6,0,TILE_ID%,0,PALETTE_WX%+PALETTE_CURSORX%+1,PALETTE_WY%+PALETTE_CURSORY%+1,0,0,0
2770 ENDPROC
2780 :
2790 DEF PROChide_palette_cursor
2800     LOCAL TILE_ID%
2810     TILE_ID%=PALETTE%(PALETTE_CURSORX%, PALETTE_CURSORY%)
2820     VDU 23,0,194,6,0,TILE_ID%,0,PALETTE_WX%+PALETTE_CURSORX%+1,PALETTE_WY%+PALETTE_CURSORY%+1,0,0,0
2830 ENDPROC
2840 :
2850 DEF PROCdraw_colour_selection(SELECTEDCOLOUR_WX%, SELECTEDCOLOUR_WY%, SELECTEDCOLOUR_WW%, SELECTEDCOLOUR_WH%, SELECTEDCOLOUR_WC%)
2860     VDU 23,0,194,6,0,SELECTEDCOLOUR_WC%,0,SELECTEDCOLOUR_WX%+1,SELECTEDCOLOUR_WY%+1,0,0,0
2870     VDU 23,0,194,6,0,SELECTEDCOLOUR_WC%,0,SELECTEDCOLOUR_WX%+2,SELECTEDCOLOUR_WY%+1,0,0,0
2880     VDU 23,0,194,6,0,SELECTEDCOLOUR_WC%,0,SELECTEDCOLOUR_WX%+1,SELECTEDCOLOUR_WY%+2,0,0,0
2890     VDU 23,0,194,6,0,SELECTEDCOLOUR_WC%,0,SELECTEDCOLOUR_WX%+2,SELECTEDCOLOUR_WY%+2,0,0,0
2900 ENDPROC
2910 :
2920 DEF PROCselect_colour(PALETTE_CURSORX%, PALETTE_CURSORY%)
2930     SELECTEDCOLOUR_WC%=PALETTE%(PALETTE_CURSORX%, PALETTE_CURSORY%)
2940     PROCdraw_colour_selection(SELECTEDCOLOUR_WX%, SELECTEDCOLOUR_WY%, SELECTEDCOLOUR_WW%, SELECTEDCOLOUR_WH%, SELECTEDCOLOUR_WC%)
2950 ENDPROC
2960 :
2970 DEF PROCselect_transparent
2980     REM TRANSPARENT TILE GRAPHIC IS TILE_ID=2
2990     SELECTEDCOLOUR_WC%=2
3000     PROCdraw_colour_selection(SELECTEDCOLOUR_WX%, SELECTEDCOLOUR_WY%, SELECTEDCOLOUR_WW%, SELECTEDCOLOUR_WH%, SELECTEDCOLOUR_WC%)
3010 ENDPROC
3020 :
3030 DEF PROCexit
3040     REM REENABLE CURSOR FLASHING
3050     VDU 23,1,1,0,0,0,0,0,0,0
3060     END
3070 ENDPROC
3080 :
3090 DEF PROCsetup_pixel_array
3100     LOCAL R%, C%, P%
3110     DIM TILE%(7,7)
3120     P%=0
3130     FOR R%=0 TO 7
3140       FOR C%=0 TO 7
3150         TILE%(C%,R%)=P%
3160       NEXT C%
3170     NEXT R%
3180 ENDPROC
3190 :
3200 DEF PROCdraw_pixel_window
3210     LOCAL R%, C%, T%
3220     FOR R%=0 TO 7
3230       FOR C%=0 TO 7
3240         T%=TILE%(C%,R%)
3250         IF T%=0 THEN T%=2
3260         VDU 23,0,194,6,0,T%,0,PIXEL_WX%+C%+1,PIXEL_WY%+R%+1,0,0,0
3270         T%=T%+1
3280       NEXT C%
3290     NEXT R%
3300 ENDPROC
3310 :
3320 DEF PROCdraw_pixel_cursor
3330     LOCAL TILE_ID%
3340     TILE_ID%=1
3350     VDU 23,0,194,6,0,TILE_ID%,0,PIXEL_WX%+PIXEL_CURSORX%+1,PIXEL_WY%+PIXEL_CURSORY%+1,0,0,0
3360 ENDPROC
3370 :
3380 DEF PROChide_pixel_cursor
3390     LOCAL TILE_ID%
3400     TILE_ID%=TILE%(PIXEL_CURSORX%, PIXEL_CURSORY%)
3410     IF TILE_ID%=0 THEN TILE_ID%=2
3420     VDU 23,0,194,6,0,TILE_ID%,0,PIXEL_WX%+PIXEL_CURSORX%+1,PIXEL_WY%+PIXEL_CURSORY%+1,0,0,0
3430 ENDPROC
3440 :
3450 DEF PROCnavigate_pixeleditor
3460     REM LOOP INPUT UNTIL TAB (TO CHANGE MODE)
3470     REPEAT
3480         A$=GET$
3490         IF ASC(A$)=8 THEN PROCmove_pixel_cursor(PIXEL_CURSORX%-1,PIXEL_CURSORY%)
3500         IF ASC(A$)=11 THEN PROCmove_pixel_cursor(PIXEL_CURSORX%,PIXEL_CURSORY%-1)
3510         IF ASC(A$)=21 THEN PROCmove_pixel_cursor(PIXEL_CURSORX%+1,PIXEL_CURSORY%)
3520         IF ASC(A$)=10 THEN PROCmove_pixel_cursor(PIXEL_CURSORX%,PIXEL_CURSORY%+1)
3530         IF ASC(A$)=13 THEN PROCwrite_pixel
3540         IF ASC(A$)=9 THEN EDITOR_MODE%=1
3550         IF A$="T" THEN PROCselect_transparent
3560         IF A$="Q" THEN PROCexit
3570         IF A$="S" THEN PROCsavetile
3580         IF A$="L" THEN PROCloadtile
3590         IF A$="B" THEN PROCcycle_background_colour
3600     UNTIL EDITOR_MODE%<>0
3610 ENDPROC
3620 :
3630 DEF PROCmove_pixel_cursor(NEW_CURSORX%, NEW_CURSORY%)
3640     LOCAL TILE_ID%
3650     IF NEW_CURSORX%<0 THEN NEW_CURSORX%=0
3660     IF NEW_CURSORX%>7 THEN NEW_CURSORX%=7
3670     IF NEW_CURSORY%<0 THEN NEW_CURSORY%=0
3680     IF NEW_CURSORY%>7 THEN NEW_CURSORY%=7
3690     REM DRAW UNDERLYING TILE OVER OLD CURSOR LOCATION
3700     TILE_ID%=TILE%(PIXEL_CURSORX%,PIXEL_CURSORY%)
3710     IF TILE_ID%=0 THEN TILE_ID%=2
3720     VDU 23,0,194,6,0,TILE_ID%,0,PIXEL_WX%+PIXEL_CURSORX%+1,PIXEL_WY%+PIXEL_CURSORY%+1,0,0,0
3730     REM DRAW CURSOR AT NEW POSITION
3740     PIXEL_CURSORX%=NEW_CURSORX%
3750     PIXEL_CURSORY%=NEW_CURSORY%
3760     PROCdraw_pixel_cursor
3770 ENDPROC
3780 :
3790 DEF PROCselect_palette_mode
3800     PROCdraw_footer("MODE: Palette Select")
3810     PROCdraw_palette_cursor
3820     PROChide_pixel_cursor
3830     PROCnavigate_palette
3840 ENDPROC
3850 :
3860 DEF PROCselect_pixel_mode
3870     PROCdraw_footer("MODE: Pixel Editor")
3880     PROCdraw_pixel_cursor
3890     PROChide_palette_cursor
3900     PROCnavigate_pixeleditor
3910 ENDPROC
3920 :
3930 DEF PROCwrite_pixel
3940     LOCAL P%, C%, R%, TILE_ID%
3950     TILE%(PIXEL_CURSORX%,PIXEL_CURSORY%)=SELECTEDCOLOUR_WC%
3960     TILE_ID%=TILE%(PIXEL_CURSORX%,PIXEL_CURSORY%)
3970     VDU 23,0,194,6,0,TILE_ID%,0,PIXEL_WX%+PIXEL_CURSORX%+1,PIXEL_WY%+PIXEL_CURSORY%+1,0,0,0
3980     :
3990     REM Update the screen
4000     PROCupdate_screen
4010     :
4020 ENDPROC
4030 :
4040 DEF PROCdraw_preview_window
4050     LOCAL TILE_ID%
4060     :
4070     REM OVERDRAW EXISTING WITH BACKGROUND TILE
4080     TILE_ID%=BGCOLOUR%
4090     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+1,PREVIEW_WY%+1,0,0,0
4100     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+2,PREVIEW_WY%+1,0,0,0
4110     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+1,PREVIEW_WY%+2,0,0,0
4120     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+2,PREVIEW_WY%+2,0,0,0
4130     :
4140     REM NOW DRAW TILE
4150     TILE_ID%=3
4160     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+1,PREVIEW_WY%+1,0,0,0
4170     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+2,PREVIEW_WY%+1,0,0,0
4180     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+1,PREVIEW_WY%+2,0,0,0
4190     VDU 23,0,194,6,0,TILE_ID%,0,PREVIEW_WX%+2,PREVIEW_WY%+2,0,0,0
4200 ENDPROC
4210 :
4220 DEF PROCdraw_reflection_window
4230     LOCAL TILE_ID%
4240     :
4250     REM OVERDRAW EXISTING WITH BACKGROUND TILE
4260     TILE_ID%=BGCOLOUR%
4270     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+1,REFLECTION_WY%+1,0,0,0
4280     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+2,REFLECTION_WY%+1,0,0,1
4290     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+1,REFLECTION_WY%+2,0,0,2
4300     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+2,REFLECTION_WY%+2,0,0,3
4310     :
4320     REM NOW DRAW TILE
4330     TILE_ID%=3
4340     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+1,REFLECTION_WY%+1,0,0,0
4350     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+2,REFLECTION_WY%+1,0,0,1
4360     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+1,REFLECTION_WY%+2,0,0,2
4370     VDU 23,0,194,6,0,TILE_ID%,0,REFLECTION_WX%+2,REFLECTION_WY%+2,0,0,3
4380 ENDPROC
4390 :
4400 DEF PROCdraw_single_window
4410     LOCAL TILE_ID%
4420     :
4430     REM OVERDRAW EXISTING WITH BACKGROUND TILE
4440     TILE_ID%=BGCOLOUR%
4450     VDU 23,0,194,6,0,TILE_ID%,0,PRSINGLEWX%+1,PRSINGLEWY%+1,0,0,0
4460     VDU 23,0,194,6,0,TILE_ID%,0,PRSINGLEWX%+2,PRSINGLEWY%+1,0,0,0
4470     VDU 23,0,194,6,0,TILE_ID%,0,PRSINGLEWX%+1,PRSINGLEWY%+2,0,0,0
4480     VDU 23,0,194,6,0,TILE_ID%,0,PRSINGLEWX%+2,PRSINGLEWY%+2,0,0,0
4490     :
4500     REM NOW DRAW TILE
4510     TILE_ID%=3
4520     VDU 23,0,194,6,0,TILE_ID%,0,PRSINGLEWX%+2,PRSINGLEWY%+2,4,4,0
4530 ENDPROC
4540 :
4550 DEF PROCdraw_header
4560     LOCAL HEADER$, SPACES%, SCREENWIDTH%
4570     COLOUR 135
4580     COLOUR 0
4590     SCREENWIDTH%=40
4600     HEADER$="TILE EDITOR 1.0"
4610     SPACES%=SCREENWIDTH%-LEN(HEADER$)
4620     VDU 31,0,0
4630     PRINT HEADER$ SPC(SPACES%);
4640     COLOUR 128
4650     COLOUR 7
4660     VDU 31,0,2
4670 ENDPROC
4680 :
4690 DEF PROCdraw_footer(FOOTER$)
4700     LOCAL SPACES%, SCREENWIDTH%, SCREENHEIGHT%
4710     COLOUR 135
4720     COLOUR 0
4730     SCREENWIDTH%=40
4740     SCREENHEIGHT%=30
4750     SPACES%=SCREENWIDTH%-LEN(FOOTER$)
4760     VDU 31,0,SCREENHEIGHT%-1
4770     PRINT FOOTER$ SPC(SPACES%);
4780     COLOUR 128
4790     COLOUR 7
4800     VDU 31,0,2
4810 ENDPROC
4820 :
4830 DEF PROCloadtile
4840     PROCgetfilename
4850     LOCAL X%, Y%, C%, R%, P%, TILE_ID%
4860     LOCAL FILE%, VERSION%, HEADER2%, HEADER3%, HEADER4%
4870     :
4880     FILE%=OPENIN(FILENAME$)
4890     VERSION%=BGET#FILE%
4900     HEADER2%=BGET#FILE%
4910     HEADER3%=BGET#FILE%
4920     HEADER4%=BGET#FILE%
4930     FOR Y%=0 TO 7
4940       FOR X%=0 TO 7
4950         TILE%(X%,Y%)=BGET#FILE%
4960       NEXT X%
4970     NEXT Y%
4980     CLOSE#FILE%
4990     :
5000     REM Update the screen
5010     PROCupdate_screen
5020 ENDPROC
5030 :
5040 DEF PROCupdate_preview_tile
5050     REM CREATE/UPDATE PREVIEW TILE_ID 
5060     TILE_ID%=3
5070     VDU 23,0,194,1,0,TILE_ID%
5080     FOR R%=0 TO 7
5090         FOR C%=0 TO 7
5100             P%=TILE%(C%,R%)
5110             VDU P%
5120         NEXT C%
5130     NEXT R%
5140 ENDPROC
5150 :
5160 DEF PROCupdate_screen
5170     PROCupdate_preview_tile
5180     PROCdraw_pixel_window
5190     PROCdraw_pixel_cursor
5200     PROCdraw_preview_window
5210     PROCdraw_reflection_window
5220     PROCdraw_single_window
5230 ENDPROC
5240 :
5250 DEF PROCsavetile
5260     PROCgetfilename
5270     LOCAL X%, Y%, C%, R%, P%, TILE_ID%
5280     LOCAL FILE%, VERSION%, HEADER2%, HEADER3%, HEADER4%
5290     :
5300     HEADER2%=0
5310     HEADER3%=0
5320     HEADER3%=0
5330     :
5340     FILE%=OPENOUT(FILENAME$)
5350     BPUT#FILE%,VERSION%
5360     BPUT#FILE%,HEADER2%
5370     BPUT#FILE%,HEADER3%
5380     BPUT#FILE%,HEADER4%
5390     FOR Y%=0 TO 7
5400       FOR X%=0 TO 7
5410         BPUT#FILE%,TILE%(X%,Y%)
5420       NEXT X%
5430     NEXT Y%
5440     CLOSE#FILE%
5450 ENDPROC
5460 :
5470 DEF PROChideframe(X%, Y%, W%, H%, C%)
5480     LOCAL I%
5490     COLOUR C%
5500     VDU 31,X%,Y%
5510     FOR I%=1 TO H%
5520         PRINT SPC(W%);
5530         VDU 31,X%,Y%+I%
5540     NEXT I%
5550     COLOUR 7
5560 ENDPROC
5570 :
5580 DEF PROCgetfilename
5590     PROCdrawframe(DIALOGUE_WX%, DIALOGUE_WY%, DIALOGUE_WW%, DIALOGUE_WH%, DIALOGUE_WC%)
5600     VDU 31,DIALOGUE_WX%+1,DIALOGUE_WY%+1
5610     INPUT "Filename: " FILENAME$
5620     PROChideframe(DIALOGUE_WX%, DIALOGUE_WY%, DIALOGUE_WW%, DIALOGUE_WH%, 0)
5630 ENDPROC
5640 :
5650 DEF PROCcycle_background_colour
5660     IF BGCYCLE%>3 THEN BGCYCLE%=0
5670     :
5680     REM SET BGCOLOUR TO BLACK
5690     IF BGCYCLE%=0 THEN BGCOLOUR%=192
5700     :
5710     REM SET BGCOLOUR TO YELLOW
5720     IF BGCYCLE%=1 THEN BGCOLOUR%=223
5730     :
5740     REM SET BGCOLOUR TO MAGENTA
5750     IF BGCYCLE%=2 THEN BGCOLOUR%=243
5760     :
5770     REM SET BGCOLOUR TO LIGHT GREY
5780     IF BGCYCLE%=3 THEN BGCOLOUR%=234
5790     :
5800     REM INCREMENT BGCYCLE FOR NEXT TIME
5810     BGCYCLE%=BGCYCLE%+1
5820     :
5830     REM UPDATE SCREENS WITH NEW VALUE
5840     PROCupdate_screen
5850 ENDPROC
